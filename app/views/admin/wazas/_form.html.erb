<%= form_with model: [:admin, @waza] do |f| %>
<div class="mb-3">
  <label class="form-label">段位</label>
  <%= f.collection_select :rank_id, Rank.ordered, :id, :name,
        { prompt: "段位を選択してください" }, class: "form-select", required: true %>
  <% if @waza.errors[:rank].present? %>
    <div class="text-danger small"><%= @waza.errors[:rank].join(", ") %></div>
  <% end %>
</div>

  <div class="mb-3">
    <%= f.label :order_in_rank, "段位内の並び順", class: "form-label" %>
    <%= f.number_field :order_in_rank, class: "form-control" %>
  </div>

  <div class="mb-3">
    <%= f.select :shinsa_set,
      Waza.shinsa_sets.keys.map { |k| [I18n.t("enums.waza.shinsa_set.#{k}"), k] },
      {},
      class: "form-select" %>
  </div>

  <div class="mb-3">
    <%= f.label :koumoku, "審査項目", class: "form-label" %>
    <%= f.text_field :koumoku, class: "form-control" %>
  </div>

  <div class="mb-3">
    <%= f.label :content, "技の説明", class: "form-label" %>
    <%= f.text_area :content, rows: 5, class: "form-control" %>
  </div>

  <hr class="my-4">

<div data-controller="nested-form">
  <div class="d-flex justify-content-between align-items-center mt-4 mb-2">
    <h6 class="mb-0">動画 (<%= @waza.videos.reject(&:marked_for_destruction?).size %>件)</h6>
    <button type="button" class="btn btn-sm btn-outline-secondary" data-action="nested-form#add">＋動画を追加</button>
  </div>

  <div data-nested-form-target="container">
    <%= f.fields_for :videos do |vf| %>
      <%= render "video_fields", f: vf %>
    <% end %>
  </div>

  <template data-nested-form-target="template">
    <%= f.fields_for :videos, Video.new, child_index: "NEW_RECORD" do |vf| %>
      <%= render "video_fields", f: vf %>
    <% end %>
  </template>
</div>

  <div class="d-grid">
    <%= f.submit (action_name == "new" ? "更新" : "更新"), class: "btn btn-primary" %>
  </div>
<% end %>
